# Meta-Awareness 系統開發計劃

## 1. 當前進度

### 1.1 已完成功能
- ✅ 每日行為記錄與評分
- ✅ 睡眠品質分析（標準作息模式）
- ✅ 每日報告生成與郵件發送
- ✅ 每週報告生成與郵件發送
- ✅ 行為分數表管理

### 1.2 進行中功能
- 🔄 長期行為指數 (LBI) 開發
- 🔄 資料管理優化
- 🔄 睡眠評分系統優化

## 2. 系統架構與功能

### 2.1 核心模組

#### BehaviorScores.js
- 行為分數配置管理
  - 行為分數表讀取與維護
  - 每日目標分數設定
  - 行為分數計算邏輯
- 評分功能
  - 每日行為效率指數 (DES) 計算
  - 效率指數計算 (LBI 基礎)
  - 行為分數查詢與管理

#### BehaviorScoreManager.js
- 行為分數管理系統
  - 從日誌收集行為數據
  - LLM 行為評分整合
  - 批量處理機制
- 分數表管理
  - 分數表初始化
  - 分數更新與維護
  - 數據一致性檢查

#### Config.js
- 系統配置管理
  - 全局參數設定
  - API 金鑰管理
  - 郵件模板配置
- 預設值管理
  - 行為分數預設值
  - 系統常量定義
  - 時區設定

#### DailyReport.js
- 每日報告生成
  - 元認知摘要生成
  - 行為數據整合
  - 睡眠數據整合
- 郵件系統
  - HTML 報告生成
  - 郵件發送管理
  - Gmail 標籤管理
- 數據處理
  - 日誌數據讀取
  - 數據驗證
  - 報告格式化

#### SleepQualityAnalyzer.js
- 睡眠分析系統
  - 睡眠健康指數計算
  - 睡眠時長評估
  - 睡眠品質評估
  - 睡眠規律性評估
- 睡眠建議生成
  - 個性化睡眠建議
  - 睡眠改善方案
  - 睡眠模式分析

### 2.2 資料流程
1. 數據收集
   - 日誌數據讀取
   - 行為數據收集
   - 睡眠數據收集

2. 數據處理
   - 行為評分計算
   - 睡眠品質分析
   - 數據整合與驗證

3. 報告生成
   - 每日摘要生成
   - HTML 報告格式化
   - 郵件發送與標籤

## 3. 短期計劃 (1-2 週)

### 3.1 資料管理優化
1. 改進每日報告輸出機制
   - [ ] 修改 `DailyReport.js` 的資料寫入邏輯
   - [ ] 實現資料覆蓋而非追加
   - [ ] 添加資料驗證機制
   - [ ] 確保每個日期只有一筆資料

2. 資料清理與維護
   - [ ] 實現定期資料清理機制
   - [ ] 添加資料備份功能
   - [ ] 建立資料一致性檢查

### 3.2 回測功能開發
1. 歷史資料分析
   - [ ] 實現指定日期範圍的資料讀取
   - [ ] 開發資料缺失處理機制
   - [ ] 建立資料驗證流程

2. 回測報告生成
   - [ ] 設計回測報告格式
   - [ ] 實現回測結果計算
   - [ ] 開發回測報告生成器

## 4. 中期計劃 (1-2 月)

### 4.1 睡眠評分系統優化
1. 多模式睡眠評分
   - [ ] 設計夜貓子作息評分標準
   - [ ] 實現作息模式自動識別
   - [ ] 開發模式切換機制
   - [ ] 建立個人化評分標準

2. 評分標準配置
   - [ ] 設計評分標準配置界面
   - [ ] 實現評分參數自訂
   - [ ] 開發評分標準切換功能

3. 睡眠分析報告優化
   - [ ] 更新睡眠評分報告格式
   - [ ] 添加作息模式分析
   - [ ] 整合多模式評分結果

### 4.2 長期行為指數 (LBI)
1. 核心功能開發
   - [ ] 實現 EMA 計算邏輯
   - [ ] 開發分數轉換函數
   - [ ] 建立資料儲存機制

2. 視覺化與報告
   - [ ] 開發趨勢圖表生成
   - [ ] 設計 LBI 報告格式
   - [ ] 整合到現有報告系統

### 4.3 系統優化
1. 效能改進
   - [ ] 優化資料讀寫效率
   - [ ] 改進 API 呼叫機制
   - [ ] 實現快取機制

2. 使用者體驗
   - [ ] 改進報告格式
   - [ ] 優化郵件通知
   - [ ] 添加更多自訂選項

## 5. 長期計劃 (3-6 月)

### 5.1 進階分析功能
- [ ] 行為模式識別
- [ ] 預測模型開發
- [ ] 個性化建議系統
- [ ] 睡眠模式深度分析
- [ ] 作息調整建議系統

### 5.2 系統擴展
- [ ] 多用戶支援
- [ ] API 整合
- [ ] 行動應用開發
- [ ] 睡眠追蹤設備整合

## 6. 技術債務

### 6.1 代碼優化
- [ ] 重構重複代碼
- [ ] 改進錯誤處理
- [ ] 添加單元測試
- [ ] 優化睡眠評分算法

### 6.2 文檔更新
- [ ] 更新 API 文檔
- [ ] 完善使用說明
- [ ] 添加開發指南
- [ ] 編寫睡眠評分標準說明

## 7. 注意事項

### 7.1 開發原則
- 保持代碼簡潔和可維護性
- 優先考慮資料安全性和一致性
- 確保向後兼容性
- 考慮不同作息模式的需求

### 7.2 風險管理
- 定期備份重要資料
- 監控系統效能
- 追蹤錯誤日誌
- 確保評分標準的科學性

## 8. 資源需求

### 8.1 技術資源
- Google Apps Script 配額
- API 使用限制
- 儲存空間管理
- 睡眠研究資料庫

### 8.2 開發工具
- 版本控制系統
- 開發環境設置
- 測試工具
- 睡眠分析工具

## 9. 使用者反饋與改進建議

### 9.1 反饋收集格式
每個反饋項目應包含：
- 時間戳記
- 使用者身份（可選）
- 問題描述
- 影響程度（高/中/低）
- 建議解決方案（如有）

### 9.2 已收集反饋

#### 2024-03-21 系統架構與隱私問題
**使用者**: Leonardo
**問題描述**:
1. DailyReport.gs 模組化程度不足
   - 影響程度: 中
   - 建議: 重構為更小的功能模組，提高代碼可維護性

2. Google Form/Sheet 表頭變更同步問題
   - 影響程度: 高
   - 問題: 當 Google Form 修改導致 Sheet headers 變更時，腳本無法自動適應
   - 建議: 實現動態表頭映射機制，或建立配置驅動的表頭映射系統

3. 數據隱私與第三方 API 依賴
   - 影響程度: 高
   - 問題: 當前需要將個人數據發送至第三方平台（如 DeepSeek）
   - 建議解決方案:
     - 短期: 實現數據匿名化處理
     - 中期: 支持本地部署模型
     - 長期: 建立私有雲部署方案

### 9.3 反饋追蹤
| 反饋日期 | 問題類型 | 狀態 | 優先級 | 預計解決時間 |
|---------|---------|------|--------|------------|
| 2024-03-21 | 架構 | 待處理 | 高 | TBD |
| 2024-03-21 | 數據同步 | 待處理 | 高 | TBD |
| 2024-03-21 | 隱私安全 | 規劃中 | 高 | TBD | 