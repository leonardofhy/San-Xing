# Meta-Awareness System: Roadmap & Milestones

**文件版本**: 1.0
**最後更新**: 2025-06-17

這份文件旨在規劃 Meta-Awareness 系統的開發路徑，記錄已完成的里程碑，並定義未來的發展方向。

---

## ✅ Milestone 1: v2.0 彈性化微服務架構 (已完成)

這個里程碑的核心目標是將系統從一個龐大、僵化的單體應用，重構為一個靈活、可擴展、易於維護的微服務架構。我們成功地解決了 `issues.md` 中定義的所有初始問題。

### 核心成就：

-   **[✓] 架構模組化**:
    -   將單一的 `DailyReport.js` 拆分為 10+ 個獨立的服務 (`SheetAdapter`, `ApiService` 等)。
    -   實現了「單一職責原則」，每個服務只做一件事。

-   **[✓] 設定與邏輯分離**:
    -   所有表頭、版本等設定統一由 `Config.js` 和 `SchemaService.js` 集中管理。
    -   消除了硬編碼的「魔法字串」，提高了系統的可維護性。

-   **[✓] 流程與執行分離**:
    -   引入 `EventBus.js`，實現了事件驅動的非同步流程，徹底解耦了各個服務。
    -   `ReportOrchestrator.js` 作為總指揮，清晰地協調整個工作流。

-   **[✓] 核心功能插件化**:
    -   **評分計算**: `ScoreCalculatorFactory.js` 允許計分演算法以「插件」形式存在，可版本化、可切換。
    -   **AI 服務**: `ApiService.js` 允許 LLM 供應商以「轉接頭」形式存在，為未來接入本地模型或更換供應商鋪平了道路。

-   **[✓] 系統強韌性提升**:
    -   `SheetAdapter.js` 能自動偵測 Schema 變更並發出警告，還能自動創建不存在的工作表。
    -   `ApiService.js` 內建了重試機制。
    -   `Main.js` 提供了豐富的除錯工具 (`testMicroservicesArchitecture`, `viewEventHistory` 等)。

**目前狀態**: 已完成架構的基礎建設，系統現在具備了高度的靈活性和擴展性，為下一步的「數據價值挖掘」做好了準備。

---

## 🚀 Milestone 2: 數據價值深化與歷史回溯 (下一步計畫)

在擁有一個穩固的架構後，下一個里程碑的目標是**真正開始挖掘數據的深層價值**，並讓 LLM 從一個「日誌轉述者」進化為一個「數據洞察分析師」。

### 關鍵任務：

#### 1. 資料層：數據的「身份證」與「家譜」

-   **目標**: 讓每一份數據都帶有可追溯的元數據 (Metadata)。
-   **具體行動**:
    -   **[ ] 豐富化 Schema**: 在 `SchemaService.js` 中，為每個欄位增加 `meta` 物件，包含 `unit` (單位，如: 分鐘/小時)、`type` (資料型別)、`description` (欄位描述)。
    -   **[ ] 算法版本標記**: 在 `ReportOrchestrator.js` 的 `ANALYSIS_COMPLETED` 事件處理中，將當前使用的計分算法版本 (例如 `behavior:v1`, `sleep:v1`) 一併寫入每日報告的儲存格中。

#### 2. 計算層：可隨時啟動的「時光機」

-   **目標**: 實現一個獨立、高效、可隨時啟動的歷史數據重算流程。
-   **具體行動**:
    -   **[ ] 建立 `HistoricalRecalculator.js` 服務**:
        -   職責：專門負責歷史數據的批量重算。
        -   功能：接收 `日期範圍`、`計算類型` (行為/睡眠)、`算法版本` 作為參數。
        -   流程：讀取範圍內的日誌 -> 呼叫 `ScoreCalculatorFactory` 進行計算 -> **只更新** 分數相關欄位，不觸發 LLM。
    -   **[ ] 在 `Main.js` 中暴露接口**: 新增一個 `runHistoricalRecalculation()` 函式，方便手動觸發。

#### 3. 洞察層：從「每日回顧」到「每週洞察」

-   **目標**: 讓 LLM 基於「統計數據」而非「單日流水帳」來產生更高層次的洞察。
-   **具體行動**:
    -   **[ ] 建立 `AggregationService.js` 服務**:
        -   職責：將每日數據聚合成更高維度的統計指標。
        -   功能：計算指定時間範圍內的平均值 (mean)、標準差 (std dev)、趨勢斜率 (trend slope) 等。例如：「本週平均睡眠時長」、「行為分數趨勢」等。
    -   **[ ] 開發 `WeeklyReportOrchestrator.js`**:
        -   流程：呼叫 `AggregationService` 產生週度統計數據 -> 將 **統計數據** 和 **每日亮點/問題行為列表** 組成新的 Prompt -> 呼叫 `ApiService` 產生週報 -> 呼叫 `EmailService` 發送週報。

#### 4. 呈現層：數據可視化

-   **目標**: 提供直觀的數據趨勢圖表。
-   **具體行動**:
    -   **[ ] 建立 `DashboardService.js` (或在 `SheetAdapter` 中擴展)**:
        -   職責：利用 Apps Script 的能力，自動在 Google Sheet 中創建或更新圖表。
        -   功能：根據 `Daily Report` 中的數據，自動生成如「睡眠時長趨勢圖」、「行為分數走勢圖」等。

### 預期成果：

完成此里程碑後，系統將能夠：
-   **動態比較不同算法**: 「用 v2 的算法算出來，我上個月的平均睡眠分數其實是 80 分，而不是 v1 算的 75 分。」
-   **提供趨勢洞察**: 「你的行為分數連續三週呈上升趨勢，尤其是在『主動學習』方面，但『運動頻率』有下降跡象。」
-   **數據驅動的建議**: LLM 的建議將基於長期的、量化的數據，而非單日的感受。

這將使 Meta-Awareness 系統從一個「高級日記本」真正轉變為一個強大的「個人成長數據分析平台」。 